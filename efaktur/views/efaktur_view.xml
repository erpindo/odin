<?xml version="1.0" encoding="utf-8"?>

<odoo>
	<data>

		<record id="efaktur_form_view" model="ir.ui.view">
			<field name="name">efaktur.form.view</field>
			<field name="model">efaktur</field>
			<field name="arch" type="xml">
				<form string="Efaktur Number">
					<sheet string="Efaktur">
						<group>
							<group>
								<field name="name" attrs="{'readonly' : [('validated','=',True)]}"/>
								<field name="npwp_o"/>
								<field name="downloaded"/>
							</group>
							<group>
								<field name="validated" readonly="1"/>
								<field name="date_validated"/>
								<field name="upload_user" readonly="1"/>
							</group>
						</group>
						<group>
							<group>
								<field name="invoice_id" domain="[('efaktur_id','=',False)]"/>
								<field name="is_vendor" readonly="1"/>
								<field name="company_id" readonly="1"/>
							</group>
							<group>
								<field name="from_picking"/>
								<field name="related_picking_id"/>
							</group>
						</group>
					</sheet>
				</form>
			</field>
		</record>

		<record id="efaktur_form_view_group" model="ir.ui.view">
			<field name="model">efaktur</field>
			<field name="inherit_id" ref="efaktur_form_view"/>
			<field name="groups_id" eval="[(6, 0, [ref('base.group_system')])]"/>
			<field name="arch" type="xml">
				<field name="validated" position="attributes">
					<attribute name="readonly">False</attribute>
				</field>
			</field>
		</record>

		<record id="efaktur_tree_view" model="ir.ui.view">
			<field name="name">efaktur.tree.view</field>
			<field name="model">efaktur</field>
			<field name="arch" type="xml">
				<tree string="Efaktur Number">
					<field name="name"/>
					<field name="invoice_id"/>
					<field name="npwp_o"/>
					<field name="is_vendor" invisible="1"/>
					<field name="from_picking" invisible="1"/>
					<field name="related_picking_id"/>
					<field name="downloaded"/>
					<field name="validated"/>
					<field name="date_validated"/>
					<field name="upload_user" invisible="1"/>
				</tree>
			</field>
		</record>

		<record id='efaktur_invoice_action' model='ir.actions.act_window'>
			<field name="name">e-Faktur</field>
			<field name="res_model">efaktur</field>
			<field name="view_mode">tree,form</field>
			<field name="domain">[('is_vendor','=', False)]</field>
			<field name="context">{'search_default_upload': True, 'search_default_used': True}</field>
			<field name="view_id" ref="efaktur_tree_view"/>
			<field name="help" type="html">
				<p class="oe_view_nocontent_create">
					e-Faktur
				</p>
			</field>
		</record>

		<menuitem id="menu_efaktur_action"
			name="e-Faktur"
			parent="account.menu_finance_receivables"
			action="efaktur_invoice_action"
			sequence="111"
			/>

		<record id="account_move_efaktur_form_view" model="ir.ui.view">
			<field name="name">account.move.efaktur.form.view</field>
			<field name="model">account.move</field>
			<field name="inherit_id" ref="account.view_move_form"/>
			<field name="arch" type="xml">
				<field name="partner_id" position="after">
					<field name="efaktur_id" domain="[('invoice_id', '=', False)]" readonly="1"/>
					<field name="replace_invoice_id" domain="[('state','=','cancel'),('partner_id','=',partner_id)]" attrs="{'readonly': [('state', '!=','draft')]}" options="{'m2o_dialog': False}"/>
				</field>
				<field name="fiscal_position_id" position="after">
					<field name="efaktur_validated" invisible="1"/>
				</field>
				<field name="type" position="after">
					<span style="font-size: 11px;" attrs="{'invisible': ['|', ('efaktur_validated', '=', True), ('efaktur_id', '=', False)]}" class="label label-danger">
						<strong>e-Faktur: Not yet Uploaded</strong>
					</span>
					<span style="font-size: 11px;" attrs="{'invisible': [('efaktur_validated', '=', False)]}" class="label label-success">
						<strong>e-Faktur: Uploaded</strong>
					</span>
				</field>
				<button name="button_draft" position="after">
					<button name="reset_efaktur" string="Reset E-Faktur" type="object" attrs="{'invisible':['|','|',('efaktur_id','=',False),('state','not in','cancel'),('efaktur_validated','=',True)]}"/>
				</button>
			</field>
		</record>

		<record id="account_move_efaktur_tree_view" model="ir.ui.view">
			<field name="name">account.move.efaktur.tree.view</field>
			<field name="model">account.move</field>
			<field name="inherit_id" ref="account.view_invoice_tree"/>
			<field name="arch" type="xml">
				<field name="invoice_user_id" position="after">
					<field name="efaktur_id"/>
				</field>
			</field>
		</record>

		<record id="system_group_view_efaktur_id" model="ir.ui.view">
			<field name="name">system.group.view.efaktur.id</field>
			<field name="model">account.move</field>
			<field name="inherit_id" ref="efaktur.account_move_efaktur_form_view"/>
			<field name="groups_id" eval="[(6, 0, [ref('base.group_system') ])]"/>
			<field name="arch" type="xml">
				<field name="efaktur_id" position="attributes">
					<attribute name="readonly">1</attribute>
				</field>
			</field>
		</record>

		<record id="invoice_supplier_form_efaktur" model="ir.ui.view">
			<field name="name">account.move.supplier.form.efaktur</field>
			<field name="model">account.move</field>
			<field name="inherit_id" ref="account.view_move_form"/>
			<field name="arch" type="xml">
				<field name="ref" position="after">
					<field name="tax_number" attrs="{'invisible': [('state', '!=','draft')]}"/>
					<field name="efaktur_id" attrs="{'invisible': [('state', '=','draft')]}" readonly="1"/>
				</field>
			</field>
		</record>

		<record id='efaktur_purchase_action' model='ir.actions.act_window'>
			<field name="name">e-Faktur Purchase</field>
			<field name="res_model">efaktur</field>
			<field name="view_mode">tree,form</field>
			<field name="domain">[('is_vendor','=',True)]</field>
			<field name="context">{'search_default_upload': True, 'search_default_used': True}</field>
			<field name="view_id" ref="efaktur_tree_view"/>
			<field name="help" type="html">
				<p class="oe_view_nocontent_create">
					e-Faktur
				</p>
			</field>
		</record>


		<!--  #############################ini emang dikomen########################## -->
		<!-- <menuitem name="e-Faktur Purchase"
			id="efaktur_purchase_menu"
			action="efaktur_purchase_action"
			parent="account.menu_finance_payables"
			sequence="111"
			/> -->

		<record id="view_efaktur_download" model="ir.ui.view">
			<field name="name">view.efaktur.download</field>
			<field name="model">efaktur</field>
			<field name="arch" type="xml">
				<search string="Search">
					<field name="invoice_id" string="Reference" filter_domain="['|','|',('invoice_id.number','ilike',self),('name','ilike',self),('related_picking_id','ilike',self)]"/>
					<field name="invoice_id" filter_domain="[('invoice_id.number','ilike',self)]"/>
					<field name="name"/>
					<field name="related_picking_id"/>
					<group>
						<filter string="Downloaded" name="downloaded" domain="[('downloaded','=','True'),('validated','!=','True')]"/>
						<separator/>
						<filter string="Not Uploaded" name="upload" domain="[('validated','=',False)]"/>
						<separator/>
						<filter string="Code Used" name="used" domain="['|',('invoice_id','!=',False),('related_picking_id','!=',False)]"/>
					</group>
				</search>
			</field>
		</record>

		<record id="res_partner_tax_form_view" model="ir.ui.view">
			<field name="name">res.partner.tax.form.view</field>
			<field name="model">res.partner</field>
			<field name="inherit_id" ref="base.view_partner_form"/>
			<field name="arch" type="xml">
				<field name="category_id" position="after">
					<field name="pkp"/>
				</field>
				<page name="sales_purchases" position="after">
					<page name="tax" string="Tax" attrs="{'invisible': [('pkp', '!=', True)]}">
						<group name="code">
							<field name="npwp"/>
							<field name="nik"/>
							<field name="digit2" attrs="{'required': [('pkp', '=', True)]}"/>
						</group>
						<group name="tax">
							<field name="tax_address"/>
							<field name="tax_name"/>
						</group>
					</page>
				</page>
			</field>
		</record>

	</data>
</odoo>
